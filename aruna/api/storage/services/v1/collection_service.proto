syntax = "proto3";

package aruna.api.storage.services.v1;
option go_package = "github.com/ArunaStorage/go-api/aruna/api/storage/services/v1";
option java_multiple_files = true;
option java_package = "com.github.ArunaStorage.java_api.aruna.api.storage.services.v1";
option java_outer_classname = "CollectionService";

import "aruna/api/storage/models/v1/models.proto";
import "aruna/api/storage/models/v1/auth.proto";
import "aruna/api/storage/models/v1/query.proto";

import "google/api/annotations.proto";


service CollectionService {
    rpc CreateNewCollection(CreateNewCollectionRequest) returns (CreateNewCollectionResponse){
        option (google.api.http) = {
            post: "/v1/collection"
            body: "*"
        };
    }
    rpc GetCollection(GetCollectionRequest) returns (GetCollectionResponse){
        option (google.api.http) = {
            get: "/v1/collection/{id}"
        };
    }

    rpc UpdateCollection(UpdateCollectionRequest) returns (UpdateCollectionResponse){
        option (google.api.http) = {
            put: "/v1/collection/{id}"
            body: "*"
        };
    }

    rpc GetObjectGroupsInCollection(GetObjectGroupsInCollectionRequest) returns (GetObjectGroupsInCollectionResponse){
        option (google.api.http) = {
            get: "/v1/collection/{collection_id}/object_groups"
        };
    }

    rpc PinCollectionVersion(PinCollectionVersionRequest) returns (PinCollectionVersionResponse){
        option (google.api.http) = {
            post: "/v1/collection/{collection_id}/pin"
            body: "*"
        };
    }


    // This request deletes the collection.
    // If with_version is true, it deletes the collection and all its versions.
    // If cascade is true, all objects that are owned by the collection will also deleted.
    // This should be avoided
    rpc DeleteCollection(DeleteCollectionRequest) returns (DeleteCollectionResponse){
        option (google.api.http) = {
            delete: "/v1/collection/{id}"
        };
    }

}

// Models:

message CreateNewCollectionRequest {
    string name = 1;
    string description = 2;
    repeated storage.models.v1.KeyValue labels = 3;
    repeated storage.models.v1.KeyValue hooks = 4;
    repeated storage.models.v1.Authorization authorization = 5;
}

message CreateNewCollectionResponse {
    string id = 1;
}

message GetCollectionRequest {
    string id = 1;

}

message GetCollectionResponse {
    storage.models.v1.CollectionOverview collection = 1;
}


// This updates the collection
// Updating a pinned collection will require a new version to be created
message UpdateCollectionRequest {
    string id = 1;
    string name = 2;
    string description = 3;
    repeated storage.models.v1.KeyValue labels = 4;
    repeated storage.models.v1.KeyValue hooks = 5;
    repeated storage.models.v1.Authorization authorization = 6;

    // If this is set, the collection will be automatically pinned to this version
    // Similar to the more explicit Pin request
    // Updating a pinned collection will make this field required
    // (optional if unpinned || required if pinned)
    storage.models.v1.Version version = 7;
}

message UpdateCollectionResponse {
    storage.models.v1.CollectionOverview collection = 1;
}

message PinCollectionVersionRequest{
    string collection_id = 1;
    storage.models.v1.Version version = 2;
}

message PinCollectionVersionResponse{
    storage.models.v1.CollectionOverview collection = 1;
}

message GetObjectGroupsInCollectionRequest{
    string collection_id = 1;
    storage.models.v1.PageRequest page_request = 2;
    storage.models.v1.LabelFilter label_filter = 3;
}

message GetObjectGroupsInCollectionResponse{
    repeated storage.models.v1.ObjectGroupOverview object_group = 1;
}

message DeleteCollectionRequest{
    string id = 1;
    bool with_versions = 2;
    bool cascade = 3;
}

message DeleteCollectionResponse{}